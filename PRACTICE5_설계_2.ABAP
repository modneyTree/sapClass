*&---------------------------------------------------------------------*
*& Report ZEDR20_PRACTICE005
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT ZEDR20_PRACTICE005.

TABLES : ZEDT20_002.
TABLES : ZEDT20_004.
TABLES : ZEDT20_007.
TABLES : ZEDT20_008.

DATA : BEGIN OF GS_STUDENT,
  ZCHECKBOX TYPE C,
  ZCODE LIKE ZEDT20_001-ZCODE,
  ZPERNR LIKE ZEDT20_001-ZPERNR,
  ZKNAME LIKE ZEDT20_001-ZKNAME,
  ZENAME LIKE ZEDT20_001-ZENAME,
  ZGENDER LIKE ZEDT20_001-ZGENDER,
  ZMAJOR LIKE ZEDT20_002-ZMAJOR,
  ZMNAME LIKE ZEDT20_002-ZMNAME,
  END OF GS_STUDENT.

DATA : BEGIN OF GS_PERNR, "사원정보테이블
  ZPERNR LIKE ZEDT00_004-ZPERNR, "사원번호
  ZPNAME LIKE ZEDT00_005-ZPNAME, "사원이름
  ZDEPCODE LIKE ZEDT00_004-ZDEPCODE, "부서코드
  ZDEPRANK LIKE ZEDT00_004-ZDEPRANK, "직급
  ZEDATE LIKE ZEDT00_004-ZEDATE, "입사일
  ZQFLAG LIKE ZEDT00_004-ZQFLAG, "퇴직상태
  ZGENDER LIKE ZEDT00_005-ZGENDER, "성별
  ZADDRESS LIKE ZEDT00_005-ZADDRESS, "주소
  ZBANKCODE LIKE ZEDT00_008-ZBANKCODE, "은행코드
  ZACCOUNT LIKE ZEDT00_008-ZACCOUNT, "계좌번호
  END OF GS_PERNR.
DATA : GT_PERNR LIKE TABLE OF GS_PERNR.

DATA : BEGIN OF GS_PERNR_ALV, "사원정보 ALV출력용
  ZPERNR LIKE ZEDT00_004-ZPERNR, "사원번호
  ZPNAME LIKE ZEDT00_005-ZPNAME, "사원이름
  ZDEPCODE LIKE ZEDT00_004-ZDEPCODE, "부서코드
  ZDEPCODE_NAME(10), "부서명
  ZDEPRANK_NAME(6),  "직급명
  ZEDATE LIKE ZEDT00_004-ZEDATE, "입사일
  ZQFLAG_NAME(4), "퇴직상태
  ZGENDER_NAME(4), "성별
  ZADDRESS LIKE ZEDT00_005-ZADDRESS, "주소
  ZBANKCODE LIKE ZEDT00_008-ZBANKCODE, "은행코드
  ZBANK_NAME(10),"은행명
  ZACCOUNT LIKE ZEDT00_008-ZACCOUNT, "계좌번호
  END OF GS_PERNR_ALV.
DATA : GT_PERNR_ALV LIKE TABLE OF GS_PERNR_ALV.

DATA : BEGIN OF GS_SALARY, "월급지급테이블
  ZPERNR LIKE ZEDT00_004-ZPERNR, "사원번호
  ZSALARY LIKE ZEDT00_008-ZSALARY, "계약금액
  ZPAY LIKE ZEDT00_008-ZSALARY, "월급
  ZRANK LIKE ZEDT00_006-ZRANK, "평가등급
  END OF GS_SALARY.
DATA : GT_SALARY LIKE TABLE OF GS_SALARY.

DATA : BEGIN OF GS_ASSESS, "평가테이블
  ZPERNR LIKE ZEDT00_004-ZPERNR, "사원번호
  ZPNAME LIKE ZEDT00_005-ZPNAME, "사원이름
  ZDEPCODE LIKE ZEDT00_004-ZDEPCODE, "부서코드
  ZDEPRANK LIKE ZEDT00_004-ZDEPRANK, "직급
  ZEDATE LIKE ZEDT00_004-ZEDATE, "입사일
  ZSALARY LIKE ZEDT00_008-ZSALARY, "계약금액
  ZRANK LIKE ZEDT00_006-ZRANK, "평가등급
  END OF GS_ASSESS.
DATA : GT_ASSESS LIKE TABLE OF GS_ASSESS.

DATA : BEGIN OF GS_ASSESS_ALV, "평가테이블 ALV출력용
  ZPERNR LIKE ZEDT00_004-ZPERNR, "사원번호
  ZPNAME LIKE ZEDT00_005-ZPNAME, "사원이름
  ZDEPCODE LIKE ZEDT00_004-ZDEPCODE, "부서코드
  ZDEPCODE_NAME(10), "부서명
  ZDEPRANK_NAME(6),  "직급명
  ZEDATE LIKE ZEDT00_004-ZEDATE, "입사일
  ZSALARY LIKE ZEDT00_008-ZSALARY, "계약금액
  ZRANK LIKE ZEDT00_006-ZRANK, "평가등급
  ZMON LIKE ZEDT00_007-ZMON01, "월급
  END OF GS_ASSESS_ALV.
DATA : GT_ASSESS_ALV LIKE TABLE OF GS_ASSESS_ALV.


"삭제용
DATA : GT_STUDENT LIKE TABLE OF ZEDT20_002.

DATA : GS_FIELDCAT TYPE SLIS_FIELDCAT_ALV.
DATA : GT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV.

DATA : GS_LAYOUT TYPE SLIS_LAYOUT_ALV.

DATA : GS_SORT TYPE SLIS_SORTINFO_ALV.
DATA : GT_SORT TYPE SLIS_T_SORTINFO_ALV.

 SELECTION-SCREEN BEGIN OF BLOCK B1 WITH FRAME.
   SELECT-OPTIONS : S_ZCODE FOR ZEDT20_002-ZCODE.
   PARAMETERS : P_ZPERNR LIKE ZEDT20_002-ZPERNR.
 "  PARAMETERS : P_ZGEN LIKE ZEDT20_002-ZGENDER MODIF ID SC1.
 SELECTION-SCREEN END OF BLOCK B1.

SELECTION-SCREEN BEGIN OF BLOCK B2 WITH FRAME.
  SELECT-OPTIONS : S_ZPERNR FOR ZEDT20_004-ZPERNR.
  SELECT-OPTIONS : S_DATE FOR ZEDT20_004-DATBI MODIF ID M1. "날짜
  PARAMETERS : S_ZDEP LIKE ZEDT20_004-ZDEPCODE MODIF ID M1. "부서코드

  "체크 : 월급지급
  PARAMETERS : S_YEAR LIKE ZEDT20_007-ZYEAR MODIF ID M2.
  PARAMETERS : S_MONTH LIKE ZEDT20_007-ZMON01 MODIF ID M2.
SELECTION-SCREEN END OF BLOCK B2.

SELECTION-SCREEN BEGIN OF BLOCK B3 WITH FRAME.
  PARAMETERS : P_INFO RADIOBUTTON GROUP R1 DEFAULT 'X' USER-COMMAND UC1.
  PARAMETERS : P_MONEY RADIOBUTTON GROUP R1.
  PARAMETERS : P_TEST RADIOBUTTON GROUP R1.
SELECTION-SCREEN END OF BLOCK B3.

SELECTION-SCREEN BEGIN OF BLOCK B4 WITH FRAME.
  PARAMETERS : Z_CHECK AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN END OF BLOCK B4.


INITIALIZATION.
S_ZCODE-LOW = 'SSU-01'.
S_ZCODE-HIGH = 'SSU-99'.
APPEND S_ZCODE.

S_DATE-LOW = '20200120'.
APPEND S_DATE.

AT SELECTION-SCREEN OUTPUT.
  LOOP AT SCREEN.
    IF SCREEN-GROUP1 = 'SC1'.
      SCREEN-INPUT = 0.
    ENDIF.

    IF SCREEN-GROUP1 = 'M1'.
      IF P_INFO = 'X'.
        SCREEN-ACTIVE = '1'.
      ELSEIF P_MONEY = 'X'.
        SCREEN-ACTIVE = '0'.
      ELSEIF P_TEST = 'X'.
        SCREEN-ACTIVE = '0'.
      ENDIF.
    ENDIF.

    IF SCREEN-GROUP1 = 'M2'.
      IF P_INFO = 'X'.
        SCREEN-ACTIVE = '0'.
      ELSEIF P_MONEY = 'X'.
        SCREEN-ACTIVE = '1'.
      ELSEIF P_TEST = 'X'.
        SCREEN-ACTIVE = '1'.
      ENDIF.
    ENDIF.

    MODIFY SCREEN.
  ENDLOOP.


START-OF-SELECTION.
  PERFORM GET_DATA.
*  PERFORM MODIFY_DATA.

END-OF-SELECTION.
"   PERFORM ALV_DISPLAY.


FORM ALV_DISPLAY .

  PERFORM FIELD_CATALOG.
  PERFORM ALV_LAYOUT.
  PERFORM ALV_SORT.
  PERFORM CALL_ALV.

ENDFORM.

FORM GET_DATA.
"   SELECT * FROM ZEDT20_002
"     INTO CORRESPONDING FIELDS OF TABLE GT_STUDENT
"     WHERE ZCODE IN S_ZCODE.

    SELECT * 
    FROM ZEDT20_002 JOIN ZEDT20_008 USING ZPERNR
    INTO CORRESPONDING FIELDS OF TABLE GT_PERNR
    WHERE ZPERNR IN S_ZPERNR
ENDFORM.

*FORM WRITE_DATA. " 함수명 수정
*  LOOP AT GT_STUDENT INTO GS_STUDENT.
*    WRITE :/ GS_STUDENT-ZCODE, GS_STUDENT-ZKNAME.
*  ENDLOOP.
*ENDFORM.

FORM FIELD_CATALOG .

  CLEAR : GS_FIELDCAT, GT_FIELDCAT.
  GS_FIELDCAT-COL_POS = 1.
  GS_FIELDCAT-FIELDNAME = 'ZCHECKBOX'.
  GS_FIELDCAT-SELTEXT_M = '체크구분'.
  GS_FIELDCAT-CHECKBOX = 'X'.
  GS_FIELDCAT-EDIT = 'X'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.

  CLEAR : GS_FIELDCAT, GT_FIELDCAT.
  GS_FIELDCAT-COL_POS = 2.
  GS_FIELDCAT-FIELDNAME = 'ZCODE'.
  GS_FIELDCAT-SELTEXT_M = '학생코드'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.

  CLEAR : GS_FIELDCAT.
  GS_FIELDCAT-COL_POS = 3.
  GS_FIELDCAT-FIELDNAME = 'ZPERNR'.
  GS_FIELDCAT-SELTEXT_M = '출석번호'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.

  CLEAR : GS_FIELDCAT.
  GS_FIELDCAT-COL_POS = 4.
  GS_FIELDCAT-FIELDNAME = 'ZMAJOR'.
  GS_FIELDCAT-SELTEXT_M = '전공'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.

  CLEAR : GS_FIELDCAT.
  GS_FIELDCAT-COL_POS = 5.
  GS_FIELDCAT-FIELDNAME = 'ZMNAME'.
  GS_FIELDCAT-SELTEXT_M = '전공명'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.

  CLEAR : GS_FIELDCAT.
  GS_FIELDCAT-COL_POS = 6.
  GS_FIELDCAT-FIELDNAME = 'ZSUM'.
  GS_FIELDCAT-SELTEXT_M = '등록금액'.
  GS_FIELDCAT-DO_SUM = 'X'.
  GS_FIELDCAT-CURRENCY = 'KRW'.
  GS_FIELDCAT-NO_ZERO = 'X'.
  GS_FIELDCAT-NO_SIGN = 'X'.
  GS_FIELDCAT-OUTPUTLEN = 20.
  GS_FIELDCAT-EMPHASIZE = 'X'.
  GS_FIELDCAT-EDIT = 'X'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.

  CLEAR : GS_FIELDCAT.
  GS_FIELDCAT-COL_POS = 7.
  GS_FIELDCAT-FIELDNAME = 'ZWAERS'.
  GS_FIELDCAT-SELTEXT_M = '통화'.
  APPEND GS_FIELDCAT TO GT_FIELDCAT.


ENDFORM.

FORM CALL_ALV .

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      i_callback_program = sy-repid    " 현재 프로그램 이름
      it_fieldcat        = GT_FIELDCAT " 필드 카탈로그
      IS_LAYOUT = GS_LAYOUT
      IT_SORT = GT_SORT
    TABLES
      t_outtab           = GT_STUDENT  " 출력할 데이터
    EXCEPTIONS
      program_error      = 1
      OTHERS             = 2.

  IF sy-subrc <> 0.
    WRITE: / 'ALV 출력 중 오류가 발생했습니다.'.
  ENDIF.

ENDFORM.

FORM ALV_LAYOUT.

  GS_LAYOUT-NO_COLHEAD = 'X'.
  GS_LAYOUT-ZEBRA = 'X'.
  GS_LAYOUT-NO_VLINE = 'X'.
  GS_LAYOUT-NO_HLINE = 'X'.
  GS_LAYOUT-EDIT = 'X'.
  GS_LAYOUT-TOTALS_BEFORE_ITEMS = 'X'.

ENDFORM.

FORM ALV_SORT.

  GS_SORT-SPOS = 1.
  GS_SORT-FIELDNAME = 'ZCODE'.
  GS_SORT-UP = 'X'.
*  GS_SORT-SUBTOT = 'X'.
  APPEND GS_SORT TO GT_SORT.

ENDFORM.